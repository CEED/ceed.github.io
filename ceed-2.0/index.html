<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Center for Efficient Exascale Discretizations</title>

        <link href="../css/bootstrap-ceed.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    
    <body>
        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="http://ceed.exascaleproject.org">CEED</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
            
            
            
                <li >
                    <a href="news/">News</a>
                </li>
            
            
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Co-Design <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
                            <li >
                                 <a href="codesign/">Approach</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="ap/">Applications</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="hw/">Hardware</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="sw/">Software</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="bps/">Benchmarks</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="miniapps/">Miniapps</a>
                            </li>
                        
                    
                    </ul>
                </li>
            
            
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Software <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
                            <li >
                                 <a href="software/">Catalog</a>
                            </li>
                        
                    
                        
                    
                        
                            <li class="active">
                                 <a href="ceed-2.0/">CEED 2.0</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="ceed-code/">CEED APIs</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="libceed/">libCEED</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="fms/">FMS</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="mfem/">MFEM</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="nek/">Nek</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="libparanumal/">libParanumal</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="gslib/">GSLIB</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="magma/">MAGMA</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="occa/">OCCA</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="petsc/">PETSc</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="pumi/">PUMI</a>
                            </li>
                        
                    
                    </ul>
                </li>
            
            
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Research <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
                            <li >
                                 <a href="thrusts/">R&D Thrusts</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="pubs/">Publications</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="fe/">Finite Elements</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="meshing/">Meshing</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="linalg/">Linear Algebra</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="discr/">Discretization</a>
                            </li>
                        
                    
                        
                            <li >
                                 <a href="vis/">Visualization</a>
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                </li>
            
            
            
            
            
                <li >
                    <a href="about/">About</a>
                </li>
            
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li>
                    <a href="https://github.com/ceed/">
                        
                            <i class="fa fa-github-square"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
        <div class="container">
            <div class="col-md-3 visible-xs visible-sm"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#ceed-20-software-distribution">CEED 2.0 Software Distribution</a></li>
        
	    
                <li><a href="#simple-installation">Simple Installation</a></li>
	    
	
	    
                <li><a href="#using-the-installation">Using the Installation</a></li>
	    
	
	    
                <li><a href="#spack-for-beginners">Spack for Beginners</a></li>
	    
	
	    
                <li><a href="#tips-and-troubleshooting">Tips and Troubleshooting</a></li>
	    
	
    
    <hr style="background-color:white; height:20px; margin-left:-1px;  margin-right:-1px; margin-top:15px; margin-bottom:10px " />
    <li class="main" style="padding:0"><a href="https://github.com/CEED/forum">Contact CEED</a> </li>
       <li><a href="https://github.com/CEED/forum"><i class="fa fa-comment-o"></i> User forum</a> </li>
       <li><a href="mailto:ceed-users@llnl.gov"><i class="fa fa-envelope-o"></i> ceed-users@llnl.gov</a> </li>
   </ul>
</div>

<!-- Possible contact icons: fa-bolt, fa-cogs, fa-user, fa-star-o -->
<!-- ... fa-comment, fa-comment-o, fa-comments, fa-comments-o, fa-bullhorn --></div> <!-- toc on top on mobile -->
            <div class="col-md-9" role="main">

<h1 id="ceed-20-software-distribution">CEED 2.0 Software Distribution</h1>
<p>The CEED distribution is a collection of software packages that can be
integrated together to enable efficient discretizations in a variety of
high-order applications on unstructured grids.</p>
<p>CEED is using the <a href="https://spack.io">Spack</a> package manager for compatible
building and installation of its software components.</p>
<p>In this version, CEED 2.0, the CEED software suite consists of the
following 12 packages, plus the CEED <em>meta-package</em>:</p>
<ul>
<li><strong>GSLIB</strong>-1.0.2</li>
<li><strong>HPGMG</strong>-0.4</li>
<li><strong>Laghos</strong>-2.0</li>
<li><strong>libCEED</strong>-0.4</li>
<li><strong>MAGMA</strong>-2.5.0</li>
<li><strong>MFEM</strong>-3.4</li>
<li><strong>Nek5000</strong>-17.0</li>
<li><strong>Nekbone</strong>-17.0</li>
<li><strong>NekCEM</strong>-7332619</li>
<li><strong>PETSc</strong>-3.11.1</li>
<li><strong>PUMI</strong>-2.2.0</li>
<li><strong>OCCA</strong>-1.0.8</li>
</ul>
<p>If you are interested in the previous release, see the
<a href="https://ceed.exascaleproject.org/ceed-1.0/">CEED-1.0</a> page.</p>
<p>First-time users should read <a href="#simple-installation">Simple Installation</a> and
<a href="#using-the-installation">Using the Installation</a> below. (Quick summary: you can
build and install all of the above packages with: <code>spack install ceed</code>)</p>
<p>If you are familiar with Spack, consider using the following machine-specific
configurations for CEED (see also the <a href="https://github.com/spack/spack-configs">spack-configs</a>
repository and the <a href="https://github.com/xsdk-project/installxSDK/tree/master/platformFiles">xSDK's config files</a>).</p>
<table>
<thead>
<tr>
<th>Platform</th>
<th>Architecture</th>
<th>Spack Configuration</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Mac</strong></td>
<td><code>darwin-highsierra-x86_64</code></td>
<td><a href="../spack/ceed2-darwin-highsierra-x86_64-packages.yaml">packages</a> <i class="fa fa-cloud-download"></i></td>
</tr>
<tr>
<td><strong>Linux</strong> (RHEL7)</td>
<td><code>linux-rhel7-x86_64</code></td>
<td><a href="../spack/ceed2-linux-rhel7-x86_64-packages.yaml">packages</a> <i class="fa fa-cloud-download"></i></td>
</tr>
<tr>
<td><strong>Linux</strong> (Ubuntu)</td>
<td><code>ubuntu18.10-x86_64</code></td>
<td><a href="../spack/ceed2-ubuntu18.10-packages.yaml">packages</a> <i class="fa fa-cloud-download"></i></td>
</tr>
<tr>
<td><strong>Cori</strong> (NERSC)</td>
<td><code>cray-cnl9-haswell</code></td>
<td><a href="../spack/ceed2-cori-packages.yaml">packages</a> <i class="fa fa-cloud-download"></i></td>
</tr>
<tr>
<td><strong>Theta</strong> (ALCF)</td>
<td><code>cray-CNL-mic_knl</code></td>
<td><a href="../spack/ceed2-theta-packages.yaml">packages</a> <i class="fa fa-cloud-download"></i></td>
</tr>
<tr>
<td><strong>Pascal</strong> (LLNL)</td>
<td><code>toss_3_x86_64_ib</code></td>
<td><a href="../spack/ceed2-pascal-packages.yaml">packages</a> <i class="fa fa-cloud-download"></i>  &nbsp; <a href="../spack/ceed2-pascal-compilers.yaml">compilers</a> <i class="fa fa-cloud-download"></i></td>
</tr>
<tr>
<td><strong>Lassen</strong> (LLNL)</td>
<td><code>linux-rhel7-ppc64le</code></td>
<td><a href="../spack/ceed2-lassen-packages.yaml">packages</a> <i class="fa fa-cloud-download"></i>  &nbsp; <a href="../spack/ceed2-lassen-compilers.yaml">compilers</a> <i class="fa fa-cloud-download"></i></td>
</tr>
</tbody>
</table>
<p>For additional details, please consult the following sections:</p>
<ul>
<li><a href="#simple-installation">Simple Installation</a></li>
<li><a href="#using-the-installation">Using the Installation</a><ul>
<li><a href="#building-mfem-based-applications">Building MFEM-based Applications</a></li>
<li><a href="#building-libceed-based-applications">Building libCEED-based Applications</a></li>
<li><a href="#gpu-demo">GPU demo</a></li>
</ul>
</li>
<li><a href="#spack-for-beginners">Spack for Beginners</a></li>
<li><a href="#tips-and-troubleshooting">Tips and Troubleshooting</a><ul>
<li><a href="#building-on-a-mac">Building on Mac</a></li>
<li><a href="#building-on-a-linux-desktop">Building on Linux</a></li>
<li><a href="#building-at-llnls-computing-center">Building at LLNL</a><ul>
<li><a href="#pascal-toss3-platforms">Pascal (TOSS3)</a></li>
<li><a href="#lassen">Lassen</a></li>
</ul>
</li>
<li><a href="#building-at-nersc">Building at NERSC</a><ul>
<li><a href="#cori">Cori</a></li>
</ul>
</li>
<li><a href="#building-at-alcf">Building at ALCF</a><ul>
<li><a href="#theta">Theta</a></li>
</ul>
</li>
<li><a href="#installing-cuda">Installing CUDA</a></li>
</ul>
</li>
</ul>
<p>The CEED team can be contacted by posting to our <a href="https://github.com/CEED/forum">User Forum</a> or
via email at <a href="mailto:ceed-users@llnl.gov">ceed-users@llnl.gov</a>.
For issues related to the CEED Spack packages,
please start a discussion on the GitHub <a href="https://github.com/orgs/spack/teams/ceed">@spack/ceed</a> page.</p>
<h2 id="simple-installation">Simple Installation</h2>
<p>If Spack is already available on your system and is visible in your <code>PATH</code>, you
can install the CEED software simply with:</p>
<pre><code class="sh">spack install -v ceed
</code></pre>

<p>To enable package testing during the build process, use instead:</p>
<pre><code class="sh">spack install -v --test=all ceed
</code></pre>

<p>If you don't have Spack, you can download it and install CEED with the following
commands:</p>
<pre><code class="sh">git clone https://github.com/spack/spack.git
cd spack
./bin/spack install -v ceed
</code></pre>

<p>To avoid long compile times, we strongly recommend that you add a <code>packages.yaml</code> file
for your platform, see above and the <a href="#tips-and-troubleshooting">Tips and Troubleshooting</a>
section.</p>
<h2 id="using-the-installation">Using the Installation</h2>
<p>Spack will install the CEED packages (and the libraries they depend on) in a
subtree of <code>./opt/spack/&lt;architecture&gt;/&lt;compiler&gt;/</code> that is specific to the
architecture and compiler used (multiple compiler and/or architecture builds can
coexist in a single Spack directory).</p>
<p>Below are several examples of how the Spack installation can be linked with and
used in user applications.</p>
<h3 id="building-mfem-based-applications">Building MFEM-based Applications</h3>
<p>The simplest way to use the Spack installation is through the
<a href="https://spack.readthedocs.io/en/latest/command_index.html#spack-location"><code>spack location</code></a> command. For example, MFEM-based codes, such as
the MFEM examples, can be simply built as follows:</p>
<pre><code class="sh">git clone https://github.com/mfem/mfem.git
cd mfem; git checkout v3.4
cd examples
make CONFIG_MK=`spack location -i mfem`/share/mfem/config.mk
cd ../miniapps/electromagnetics
make CONFIG_MK=`spack location -i mfem`/share/mfem/config.mk
</code></pre>

<p>Alternatively, the Spack installation can be exported to a local directory:</p>
<pre><code class="sh">mkdir ceed
spack view --verbose symlink ceed/mfem mfem
</code></pre>

<p>The <code>ceed/mfem</code> directory now contains the Spack-built MFEM with all of its
dependencies (technically, it contains links to all the build files inside the
<code>./opt/spack/</code> subdirectory for MFEM). In particular, the MFEM library in
<code>ceed/mfem/lib</code> and the MFEM build configuration file in
<code>ceed/mfem/share/mfem/config.mk</code>.</p>
<p>This directory can be used to build the MFEM examples as follows:</p>
<pre><code class="sh">git clone https://github.com/mfem/mfem.git
cd mfem; git checkout v3.4
cd examples/petsc
make CONFIG_MK=../../../ceed/mfem/share/mfem/config.mk
cd ..
make CONFIG_MK=../../ceed/mfem/share/mfem/config.mk
</code></pre>

<p>The MFEM miniapps can further be built with:</p>
<pre><code class="sh">cd ../miniapps/electromagnetics
make CONFIG_MK=../../../ceed/mfem/share/mfem/config.mk
</code></pre>

<h3 id="building-libceed-based-applications">Building libCEED-based Applications</h3>
<p>Below we illustrate how to use the Spack installation to build libCEED-based
applications, by building the examples in the current libCEED distribution.</p>
<p>Using <a href="https://spack.readthedocs.io/en/latest/command_index.html#spack-location"><code>spack location</code></a>, the libCEED examples can be built as
follows:</p>
<pre><code class="sh">git clone https://github.com/CEED/libCEED.git
cd libCEED/examples/ceed
make CEED_DIR=`spack location -i libceed`
./ex1 -ceed /cpu/self
</code></pre>

<p>If you have multiple builds of <code>libceed</code> or <code>occa</code> you need to be more specific
in the above <a href="https://spack.readthedocs.io/en/latest/command_index.html#spack-location"><code>spack location</code></a> command. To list all <code>libceed</code> and
<code>occa</code> versions use <a href="https://spack.readthedocs.io/en/latest/command_index.html#spack-find"><code>spack find</code></a>:</p>
<pre><code class="sh">spack find -lv libceed occa
</code></pre>

<p>Then either use <a href="https://spack.readthedocs.io/en/latest/basic_usage.html#specs-dependencies">variants</a> to choose a unique version, e.g.
<code>libceed~cuda</code>, or specify the hashes printed in front of the <code>libceed</code>
<a href="https://spack.readthedocs.io/en/latest/basic_usage.html#specs-dependencies">spec</a>, e.g. <code>libceed/yb3fvek</code> or just <code>/yb3fvek</code> (and similarly
for <code>occa</code>).</p>
<p>The serial, OpenMP, OpenCL and GPU OCCA backends can be used with:</p>
<pre><code class="sh">./ex1 -ceed /cpu/occa
./ex1 -ceed /omp/occa
./ex1 -ceed /ocl/occa
./ex1 -ceed /gpu/occa
</code></pre>

<p>In order to use the OCCA GPU backend, one needs to install CEED with the <code>cuda</code>
<a href="https://spack.readthedocs.io/en/latest/basic_usage.html#specs-dependencies">variant</a> enabled, i.e. using the <a href="https://spack.readthedocs.io/en/latest/basic_usage.html#specs-dependencies">spec</a> <code>ceed+cuda</code>:</p>
<pre><code class="sh">spack install -v ceed+cuda
</code></pre>

<p>For more details, see the section <a href="#gpu-demo">GPU demo</a> below.</p>
<p>With the MAGMA backend, the <code>/cpu/magma</code> and <code>/gpu/magma</code> resource descriptors
can also be used.</p>
<p>The MFEM/libCEED and PETSc/libCEED examples can be further built with:</p>
<pre><code class="sh">cd examples/mfem
make CEED_DIR=`spack location -i libceed` MFEM_DIR=`spack location -i mfem`
./bp1 -no-vis -o 2 -ceed /cpu/self -m `spack location -i mfem`/share/mfem/data/star.mesh
./bp3 -no-vis -o 2 -ceed /cpu/self -m `spack location -i mfem`/share/mfem/data/star.mesh
cd ../petsc
make CEED_DIR=`spack location -i libceed` PETSC_DIR=`spack location -i petsc`
./bp1 -degree 2 -ceed /cpu/self
</code></pre>

<p>Note that if <code>PETSC_ARCH</code> is set in your environment, you must either unset it
or also pass <code>PETSC_ARCH=</code> in the above command.</p>
<p>Depending on the available backends, additional CEED resource descriptors,
e.g. <code>petsc/bp1 -degree 2 -ceed /ocl/occa</code> or <code>mfem/bp1 -no-vis --order 2 -ceed
/gpu/occa</code> can be provided.</p>
<p>Finally, the Nek5000/libCEED examples can be built as follows:</p>
<pre><code class="sh">cd ../nek5000
export CEED_DIR=`spack location -i libceed` NEK5K_DIR=`spack location -i nek5000`
./make-nek-examples.sh
</code></pre>

<p>Then you can run the Nek5000 examples as follows:</p>
<pre><code>export MPIEXEC=`spack location -i openmpi`/bin/mpiexec
./run-nek-example.sh -e bp1 -c /cpu/self -n 2 -b 3
</code></pre>

<p>In the above example, replace <code>openmpi</code> with whatever the MPI implementation
you have installed with spack. Also, you can do <code>./run-nek-example.sh -h</code>
to find out the options supported by the run script.</p>
<pre><code>options:
   -h|-help     Print this usage information and exit
   -c|-ceed     Ceed backend to be used for the run (optional, default: /cpu/self)
   -e|-example  Example name (optional, default: bp1)
   -n|-np       Specify number of MPI ranks for the run (optional, default: 4)
   -b|-box      Specify the box geometry to be found in ./boxes/ directory (Mandatory)
</code></pre>

<p>More information on running the Nek5000 examples can be found in the libCEED
<a href="https://github.com/CEED/libCEED/blob/master/examples/nek5000/README.md">documentation</a>.</p>
<p>Alternatively, one can export the Spack install to a local directory:</p>
<pre><code class="sh">spack view --verbose symlink ceed/libceed libceed
spack view --verbose symlink ceed/petsc petsc
spack view --verbose symlink ceed/mfem mfem
spack view --verbose symlink ceed/nek5000 nek5000
</code></pre>

<p>and use that to specify the <code>CEED_DIR</code>, <code>MFEM_DIR</code> and <code>PETSC_DIR</code> variables:</p>
<pre><code class="sh">cd libCEED/examples/ceed
make CEED_DIR=../../ceed/libceed
./ex1 -ceed /cpu/self
cd mfem
make CEED_DIR=../../../ceed/libceed MFEM_DIR=../../../ceed/mfem
./bp1 -no-vis -o 2 -ceed /cpu/self -m `spack location -i mfem`/share/mfem/data/star.mesh
./bp3 -no-vis -o 2 -ceed /cpu/self -m `spack location -i mfem`/share/mfem/data/star.mesh
cd ../petsc
make CEED_DIR=../../../ceed/mfem PETSC_DIR=../../../ceed/petsc
./bp1 -degree 2 -ceed /cpu/self
</code></pre>

<h3 id="gpu-demo">GPU demo</h3>
<p>Below is the full set of commands to install the CEED distribution on a
GPU-capable machine and then use its libCEED GPU kernels to accelerate MFEM,
PETSc and Nek examples. Note that these are very different codes (C++, C, F77)
which can nevertheless take advantage through libCEED of a common set of GPU
kernels.</p>
<p>The <code>setenv</code> commands below assume <code>csh</code>/<code>tcsh</code>. We strongly recommend to add a
<code>packages.yaml</code> file in order to avoid long compile times, see <a href="#tips-and-troubleshooting">Tips and
Troubleshooting</a>.</p>
<pre><code class="sh"># Install CEED 2.0 distribution via Spack
git clone https://github.com/spack/spack.git
cd spack
spack install ceed+cuda

# Setup CEED component directories
setenv CEED_DIR  `spack location -i libceed`
setenv MFEM_DIR  `spack location -i mfem`
setenv PETSC_DIR `spack location -i petsc`
setenv NEK5K_DIR `spack location -i nek5000`

# Clean OCCA cache
# rm -rf ~/.occa

# Clone libCEED examples directory as proxy for libCEED-based codes
git clone https://github.com/CEED/libCEED.git
mv libCEED/examples ceed-examples
rm -rf libCEED

# libCEED examples on CPU and GPU
cd ceed-examples/ceed
make
./ex1 -ceed /cpu/self/ref/blocked
./ex1 -ceed /gpu/cuda/ref
cd ../..

# MFEM+libCEED examples on CPU and GPU
cd ceed-examples/mfem
make
./bp1 -ceed /cpu/self/ref/blocked -no-vis -m `spack location -i mfem`/share/mfem/data/star.mesh
./bp1 -ceed /gpu/cuda/ref -no-vis -m `spack location -i mfem`/share/mfem/data/star.mesh
cd ../..

# PETSc+libCEED examples on CPU and GPU
cd ceed-examples/petsc
make
./bp1 -ceed /cpu/self/ref/blocked
./bp1 -ceed /gpu/cuda/ref
cd ../..

# Nek+libCEED examples on CPU and GPU
cd ceed-examples/nek5000
./make-nek-examples.sh
./run-nek-example.sh -ceed /cpu/self/ref/blocked -b 3
./run-nek-example.sh -ceed /gpu/cuda/ref -b 3
cd ../..
</code></pre>

<h2 id="spack-for-beginners">Spack for Beginners</h2>
<p>Spack is a package manager for scientific software that supports multiple
versions, configurations, platforms, and compilers.</p>
<p>While Spack does not change the build system that already exists in each CEED
component, it coordinates the dependencies between these components and enables
them to be built with the same compilers and options.</p>
<p>If you are new to Spack, here are some Spack commands and options that you may
find useful:</p>
<ul>
<li>
<p>Spack is a set of Python scripts so there is nothing to install!
  Just download with <code>git clone https://github.com/spack/spack.git</code> and add
  <code>spack/bin</code> to your path with the following commands:
  <code>. share/spack/setup-env.sh</code> for <code>bash</code>/<code>zsh</code> or
  <code>setenv SPACK_ROOT `pwd`; source $SPACK_ROOT/share/spack/setup-env.csh</code>
  for <code>csh</code>/<code>tcsh</code>.</p>
</li>
<li>
<p>Spack should automatically locate the standard compilers on your system.  Use
  <code>spack compilers</code> to list the ones that have been found. If you need to
  configure additional compilers, you can do that through the config file,
  <code>~/.spack/compilers.yaml</code>, or the platform-specific config file,
  <code>~/.spack/&lt;platform&gt;/compilers.yaml</code>. Some examples of such files are
  provided below. Check the <a href="https://spack.readthedocs.io/en/latest/getting_started.html#compiler-configuration">Spack documentation</a> for additional
  details.</p>
</li>
<li>
<p>Spack likes to build all of its packages. The file <code>~/.spack/packages.yaml</code>,
  and similarly the platform-specific, <code>~/.spack/&lt;platform&gt;/packages.yaml</code>,
  allow you to list the packages already installed on your system for Spack to
  use instead of compiling them itself. Some examples are provided below.</p>
</li>
<li>
<p>Skip the <code>-v</code> option of <code>spack install</code> to see only a summary for the building
  of each package (as opposed to the compilation of individual files): <code>spack
  install ceed</code>.  You can still turn the detailed build output on and off by
  pressing the <code>v</code> key in the Spack terminal.</p>
</li>
<li>
<p>To troubleshoot the spack install process: <code>spack --debug --verbose install ceed</code>.</p>
</li>
<li>
<p>To do a dry run of the spack install process: <code>spack install --fake ceed</code>.
  Note that you will have to run <code>spack uninstall --all</code> to clean up after this.</p>
</li>
<li>
<p>To see the specific packages that will be installed for a particular package,
  e.g. <code>ceed</code>, use: <code>spack spec -I ceed</code>.</p>
</li>
<li>
<p>To see the list of all installed packages: <code>spack find</code>.</p>
</li>
<li>
<p>To list the location where all different versions of the <code>ceed</code> package were
  installed: <code>spack find --long --paths ceed</code>. Alternatively, for a specific
  version you can use <code>spack location --install-dir ceed</code>.</p>
</li>
<li>
<p>To uninstall a package, e.g. mfem, including all packages that depend on it:
  <code>spack uninstall --all --dependents mfem</code>, or <code>spack uninstall /qzn2u7t</code> for a
  particular hash.</p>
</li>
<li>
<p>To uninstall <em>all</em> packages that were ever installed by Spack: <code>spack
  uninstall --all</code>.  In this case you may also want to clear the caches that
  Spack maintains with: <code>spack clean -a</code>.</p>
</li>
</ul>
<h2 id="tips-and-troubleshooting">Tips and Troubleshooting</h2>
<h3 id="building-on-a-mac">Building on a Mac</h3>
<p>The file <a href="../spack/ceed2-darwin-highsierra-x86_64-packages.yaml">ceed2-darwin-highsierra-x86_64-packages.yaml</a>
provides a sample <code>packages.yaml</code> file based on <a href="https://brew.sh/">Homebrew</a>, that should work on
most Macs. (You can use MacPorts instead of Homebrew if you prefer.)</p>
<pre><code class="yaml">packages:
    all:
        compiler: [clang]
        providers:
            blas: [veclibfort]
            lapack: [veclibfort]
            mpi: [openmpi]
    openmpi:
        paths:
            openmpi@3.0.0: ~/brew
        buildable: False

    cmake:
        paths:
            cmake@3.10.2: ~/brew
        buildable: False
    cuda:
        paths:
            cuda@9.1.85: /usr/local/cuda
        buildable: False
    libx11:
        paths:
            libx11@system: /opt/X11
        version: [system]
        buildable: False
    libxt:
        paths:
            libxt@system: /opt/X11
        version: [system]
        buildable: False
    xproto:
        paths:
            # see /opt/X11/lib/pkgconfig/xproto.pc
            xproto@7.0.31: /opt/X11
        version: [7.0.31]
        buildable: False
    python:
        paths:
            python@2.7.10: /usr
        buildable: False
    zlib:
        paths:
            zlib@1.2.11: /usr
        buildable: False
</code></pre>

<p>The packages in <code>~/brew</code> were installed with <code>brew install package</code>.  If you
don't have Homebrew, you can install it and the needed tools with:</p>
<pre><code class="sh">git clone https://github.com/Homebrew/brew.git
cd brew
bin/brew install openmpi cmake python zlib
</code></pre>

<p>The packages in <code>/usr</code> are provided by Apple and come pre-built with Mac OS
X. The <code>cuda</code> package is provided by NVIDIA and should be installed separately
by downloading it from <a href="https://developer.nvidia.com">NVIDIA</a>. We are using the Clang compiler,
OpenMPI, and Apple's BLAS/LAPACK accelerator library.</p>
<h3 id="building-on-a-linux-desktop">Building on a Linux Desktop</h3>
<p>The file <a href="../spack/ceed2-linux-rhel7-x86_64-packages.yaml">ceed2-linux-rhel7-x86_64-packages.yaml</a>
provides a sample <code>packages.yaml</code> file that can be adapted to work on a RHEL7 Linux
desktop</p>
<pre><code class="yaml">packages:
    all:
        compiler: [gcc]
        providers:
            mpi: [openmpi]
            blas: [netlib-lapack]
            lapack: [netlib-lapack]
    netlib-lapack:
        paths:
            netlib-lapack@system: /usr/lib64
        buildable: False
    openmpi:
        paths:
            openmpi@3.0.0: ~/local
        buildable: False

    cmake:
        paths:
            cmake@3.10.2: ~/local
        buildable: False
    cuda:
        paths:
            cuda@9.1.85: ~/local/cuda
        buildable: False
    libx11:
        paths:
            libx11@system: /usr
        version: [system]
        buildable: False
    libxt:
        paths:
            libxt@system: /usr
        version: [system]
        buildable: False
    xproto:
        paths:
            xproto@7.0.32: /usr
        version: [7.0.32]
        buildable: False
    python:
        paths:
             python@2.7.14: /usr
        buildable: False
    zlib:
        paths:
            zlib@1.2.11: /usr/lib64
        buildable: False
</code></pre>

<p>The above file uses user-installed OpenMPI, CMake and CUDA packages, with the
rest of the CEED prerequisites installed via the <a href="https://en.wikipedia.org/wiki/Yellow_Dog_Updater,_Modified">yum package manager</a>.</p>
<p>A very similar file, <a href="../spack/ceed2-ubuntu18.10-packages.yaml">ceed2-ubuntu18.10-packages.yaml</a>
provides Spack configuration for the Ubuntu distribution:</p>
<pre><code class="yaml">packages:
    all:
        compiler: [gcc]
        providers:
            mpi: [mpich]
            blas: [openblas]
            lapack: [openblas]
    openblas:
        paths:
            openblas@system: /usr/lib
        buildable: False
    mpich:
        paths:
            mpich@3.3: /usr/local
        buildable: False

    cmake:
        paths:
            cmake@3.12.1: /usr
        buildable: False
    libx11:
        paths:
            libx11@system: /usr
        version: [system]
        buildable: False
    libxt:
        paths:
            libxt@system: /usr
        version: [system]
        buildable: False
    xproto:
        paths: # See /usr/share/pkgconfig/xproto.pc for version
            xproto@7.0.32: /usr
        buildable: False
    python:
        paths:
             python@3.6.7: /usr
        buildable: False
    zlib:
        paths:
            zlib@1.2.11: /usr/lib
        buildable: False
</code></pre>

<p>In this case we use GCC and other development packages via <code>apt install</code> and
with MPICH installed separately (as needed to use containerized HPC environments
like Shifter and Singularity). You can use</p>
<pre><code class="sh">docker pull jedbrown/ceed-base
</code></pre>

<p>to get a build environment that is ready for <code>spack install ceed</code>.</p>
<h3 id="building-at-llnls-computing-center">Building at LLNL's Computing Center</h3>
<h4 id="pascal-toss3-platforms">Pascal (TOSS3 Platforms)</h4>
<p>The file <a href="../spack/ceed2-pascal-packages.yaml">ceed2-pascal-packages.yaml</a> is an
example of a <code>packages.yaml</code> file for the TOSS3 system type at LLNL's <a href="https://hpc.llnl.gov/hardware/platforms">Livermore
Computing</a> center.</p>
<pre><code class="yaml">packages:
  cmake:
    paths:
      cmake@3.13.4: /usr/tce/packages/cmake/cmake-3.13.4
    version: [3.13.4]
    buildable: False

  python:
    paths:
      python@2.7.14: /usr/tce/packages/python/python-2.7.14
    version: [2.7.14]
    buildable: False

  libx11:
    paths:
      libx11@system: /usr
    version: [system]
    buildable: False

  libxt:
    paths:
      libxt@system: /usr
    version: [system]
    buildable: False

  xproto:
    paths:
      # see /usr/share/pkgconfig/xproto.pc
      xproto@7.0.32: /usr
    version: [7.0.32]
    buildable: False

  mvapich2:
    paths:
      mvapich2@2.2%intel@18.0.1: /usr/tce/packages/mvapich2/mvapich2-2.2-intel-18.0.1
      mvapich2@2.2%gcc@4.9.3: /usr/tce/packages/mvapich2/mvapich2-2.2-gcc-4.9.3

  intel-mkl:
    paths:
      intel-mkl@2018.0.128: /usr/tce/packages/mkl/mkl-2018.0
    version: [2018.0.128]
    buildable: False

  cuda:
    paths:
      cuda@10.0.130: /usr/tce/packages/cuda/cuda-10.0.130
    version: [10.0.130]
    buildable: False

  all:
    compiler: [intel, gcc]
    providers:
      mpi: [mvapich2]
      blas: [intel-mkl, openblas]
      lapack: [intel-mkl, openblas]
</code></pre>

<p>The above file can be used to build CEED with different compilers (Intel being
the default), for example:</p>
<pre><code class="sh">spack install ceed%gcc~petsc
</code></pre>

<p>A corresponding <code>compilers.yaml</code> file for the TOSS3 platform can be found here:
<a href="../spack/ceed2-pascal-compilers.yaml">ceed2-pascal-compilers.yaml</a>.</p>
<h4 id="lassen">Lassen</h4>
<p>The file <a href="../spack/ceed2-lassen-packages.yaml">ceed2-lassen-packages.yaml</a> is an
example of a <code>packages.yaml</code> file for the Lassen system at LLNL's <a href="https://hpc.llnl.gov/hardware/platforms">Livermore
Computing</a> center, which is similar to the <a href="https://hpc.llnl.gov/hardware/platforms/sierra">Sierra</a> supercomputer.</p>
<pre><code class="yaml">packages:
    all:
        compiler: [xl_r, xl, gcc]
        providers:
            mpi: [spectrum-mpi]
            blas: [essl]
            lapack: [netlib-lapack]
    essl:
        paths:
            essl@6.1.0: /usr/tcetmp/packages/essl/essl-6.1.0
        variants: threads=none
        version: [6.1.0]
        buildable: False
    veclibfort:
        buildable: False
    intel-parallel-studio:
        buildable: False
    intel-mkl:
        buildable: False
    atlas:
        buildable: False
    openblas:  # OpenBLAS can be built only with gcc
        buildable: False
    netlib-lapack: # prefer netlib-lapack with '+external-blas' and '~lapacke' variant
        variants: +external-blas~lapacke
    spectrum-mpi:
        paths:
            spectrum-mpi@2019-01-30%xl_r@16.1.1: /usr/tce/packages/spectrum-mpi/spectrum-mpi-2019.01.30-xl-2019.02.07
            spectrum-mpi@2019-01-30%gcc@4.9.3: /usr/tce/packages/spectrum-mpi/spectrum-mpi-2019.01.30-gcc-4.9.3
            spectrum-mpi@2019-01-30%gcc@7.3.1: /usr/tce/packages/spectrum-mpi/spectrum-mpi-2019.01.30-gcc-7.3.1
        buildable: False

    cmake:
        paths:
            cmake@3.9.2: /usr/tce/packages/cmake/cmake-3.9.2
        version: [3.9.2]
        buildable: False
    cuda:
        paths:
            cuda@9.2.148: /usr/tce/packages/cuda/cuda-9.2.148
        version: [9.2.148]
        buildable: False
    libx11:
        paths:
            libx11@system: /usr
        version: [system]
        buildable: False
    libxt:
        paths:
            libxt@system: /usr
        version: [system]
        buildable: False
    xproto:
        paths:
            # see /usr/share/pkgconfig/xproto.pc
            xproto@7.0.31: /usr
        version: [7.0.31]
        buildable: False
    python:
        paths:
            python@2.7.14: /usr/tce/packages/python/python-2.7.14
        version: [2.7.14]
        buildable: False
</code></pre>

<p>The above file can be used to build CEED with different compilers (xl being
the default), for example:</p>
<pre><code class="sh">spack install ceed%gcc~petsc
</code></pre>

<p>A corresponding <code>compilers.yaml</code> file for Lassen can be found here:
<a href="../spack/ceed2-lassen-compilers.yaml">ceed2-lassen-compilers.yaml</a>.</p>
<h3 id="building-at-nersc">Building at NERSC</h3>
<h4 id="cori">Cori</h4>
<p>The file <a href="../spack/ceed2-cori-packages.yaml">ceed2-cori-packages.yaml</a> is an example of a
<code>packages.yaml</code> file for the Cori system at <a href="http://www.nersc.gov">NERSC</a>.</p>
<pre><code class="yaml">packages:
    all:
        compiler: [gcc@7.3.0, intel@18.0.5.274]
        providers:
            mpi: [mpich]
            mkl: [intel-mkl]
            blas: [intel-mkl, cray-libsci]
            scalapack: [intel-mkl, cray-libsci]
            pkgconfig: [pkg-config]
    mpich:
        modules:
            mpich@3.2%gcc@7.3.0 arch=cray-cnl9-haswell: cray-mpich
            mpich@3.2%intel@18.0.5.274 arch=cray-cnl9-haswell: cray-mpich
        buildable: False
    intel-mkl:
        buildable: false
        paths:
            intel-mkl@2018.3.222%intel: /opt/intel
            intel-mkl@2018.3.222%gcc: /opt/intel
    pkg-config:
        buildable: false
        paths:
            pkg-config@0.28: /usr
    cmake:
        modules:
            cmake@3.14.0%gcc@7.3.0 arch=cray-cnl9-haswell: cmake
            cmake@3.14.0%intel@18.0.5.274 arch=cray-cnl9-haswell: cmake
        buildable: False
    libx11:
        paths:
            libx11@system: /usr
        version: [system]
        buildable: False
    libxt:
        paths:
            libxt@system: /usr
        version: [system]
        buildable: False
    xproto:
        paths: # See /usr/lib64/pkgconfig/xproto.pc for version
            xproto@7.0.28: /usr
        buildable: False
    python:
        paths:
            python@2.7.13: /usr
        buildable: False
    boost:
        modules:
            boost@1.69.0%gcc@7.3.0 arch=cray-cnl9-haswell: boost
            boost@1.69.0%intel@18.0.5.274 arch=cray-cnl9-haswell: boost
        buildable: False
    m4:
        modules:
            m4@1.4.17%gcc@7.3.0 arch=cray-cnl9-haswell: m4
            m4@1.4.17%intel@18.0.5.274 arch=cray-cnl9-haswell: m4
        buildable: False
    openssl:
        modules:
            openssl@1.1.0a%gcc@7.3.0 arch=cray-cnl9-haswell: openssl
            openssl@1.1.0a%intel@18.0.5.274 arch=cray-cnl9-haswell: openssl
        buildable: False
    perl:
        paths:
            perl@5.18.2%gcc@7.3.0 arch=cray-cnl9-haswell: /usr
            perl@5.18.2%intel@18.0.5.274 arch=cray-cnl9-haswell: /usr
        buildable: False
    autoconf:
        modules:
            autoconf@2.69%gcc@7.3.0 arch=cray-cnl9-haswell: autoconf
            autoconf@2.69%intel@18.0.5.274 arch=cray-cnl9-haswell: autoconf
        buildable: False
    automake:
        modules:
            automake@1.15%gcc@7.3.0 arch=cray-cnl9-haswell: automake
            automake@1.15%intel@18.0.5.274 arch=cray-cnl9-haswell: automake
        buildable: False
</code></pre>

<h3 id="building-at-alcf">Building at ALCF</h3>
<h4 id="theta">Theta</h4>
<p>The file <a href="../spack/ceed2-theta-packages.yaml">ceed2-theta-packages.yaml</a> is an example of a
<code>packages.yaml</code> file for the Theta system at <a href="https://www.alcf.anl.gov">ALCF</a>.</p>
<p><i class="fa fa-warning"></i> Note: You have to unload the xalt module on Theta
with <code>module unload xalt</code>. Otherwise suite-sparse fails to build.</p>
<pre><code class="yaml">packages:
  cmake:
    paths:
      cmake@3.5.2%gcc@8.2.0 arch=cray-CNL-mic_knl: /usr
      cmake@3.5.2%intel@16.0.3.210 arch=cray-CNL-mic_knl: /usr
    buildable: False
  python:
    paths:
      python@2.7.13%gcc@8.2.0 arch=cray-CNL-mic_knl: /usr
      python@2.7.13%intel@16.0.3.210 arch=cray-CNL-mic_knl: /usr
    buildable: False
  pkg-config:
    paths:
      pkg-config@0.28%gcc@8.2.0 arch=cray-CNL-mic_knl: /usr
      pkg-config@0.28%intel@16.0.3.210 arch=cray-CNL-mic_knl: /usr
    buildable: False
  autoconf:
    paths:
      autoconf@2.69%gcc@8.2.0 arch=cray-CNL-mic_knl: /usr
      autoconf@2.69%intel@16.0.3.210 arch=cray-CNL-mic_knl: /usr
    buildable: False
  automake:
    paths:
      automake@1.13.4%gcc@8.2.0 arch=cray-CNL-mic_knl: /usr
      automake@1.13.4%intel@16.0.3.210 arch=cray-CNL-mic_knl: /usr
    buildable: False
  libtool:
    paths:
      libtool@2.4.2%gcc@8.2.0 arch=cray-CNL-mic_knl: /usr
      libtool@2.4.2%intel@16.0.3.210 arch=cray-CNL-mic_knl: /usr
    buildable: False
  m4:
    paths:
      m4@1.4.16%gcc@8.2.0 arch=cray-CNL-mic_knl: /usr
      m4@1.4.16%intel@16.0.3.210 arch=cray-CNL-mic_knl: /usr
    buildable: False
  intel-mkl:
    paths:
      intel-mkl@16.0.3.210%intel@16.0.3.210 arch=cray-CNL-mic_knl: /opt/intel
    buildable: False
  mpich:
    modules:
      # requires 'module load cce' otherwise gives parsing error
      mpich@7.6.3%gcc@8.2.0 arch=cray-CNL-mic_knl: cray-mpich/7.6.3
      mpich@7.6.3%intel@16.0.3.210 arch=cray-CNL-mic_knl: cray-mpich/7.6.3
    buildable: False
  boost:
    paths:
      boost@1.64.0%gcc@8.2.0 arch=cray-CNL-mic_knl: /soft/libraries/boost/1.64.0/gnu
      boost@1.64.0%intel@16.0.3.210 arch=cray-CNL-mic_knl: /soft/libraries/boost/1.64.0/intel
    buildable: False
  all:
    providers:
      mpi: [mpich]
    compiler: [gcc@8.2.0]
</code></pre>

<h3 id="installing-cuda">Installing CUDA</h3>
<ul>
<li>
<p>Several CEED packages depend on CUDA: OCCA, MAGMA and libCEED.</p>
</li>
<li>
<p>To build these, add the <code>cuda</code> variant to the Spack build:
  <code>sh
  spack install ceed+cuda</code></p>
</li>
<li>
<p>You will need to have the NVIDIA CUDA SDK and driver installed on your system,
  see <a href="https://developer.nvidia.com">developer.nvidia.com</a>, and specify it in the <code>packages.yaml</code>
  file. See, for example, the <code>cuda</code> section in <a href="#building-on-a-mac">Building on a Mac</a>,
  or the <a href="../spack/ceed2-linux-rhel7-x86_64-packages.yaml">ceed2-linux-rhel7-x86_64-packages.yaml</a> file.</p>
</li>
</ul></div>
            <div class="col-md-3 hidden-xs hidden-sm"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#ceed-20-software-distribution">CEED 2.0 Software Distribution</a></li>
        
	    
                <li><a href="#simple-installation">Simple Installation</a></li>
	    
	
	    
                <li><a href="#using-the-installation">Using the Installation</a></li>
	    
	
	    
                <li><a href="#spack-for-beginners">Spack for Beginners</a></li>
	    
	
	    
                <li><a href="#tips-and-troubleshooting">Tips and Troubleshooting</a></li>
	    
	
    
    <hr style="background-color:white; height:20px; margin-left:-1px;  margin-right:-1px; margin-top:15px; margin-bottom:10px " />
    <li class="main" style="padding:0"><a href="https://github.com/CEED/forum">Contact CEED</a> </li>
       <li><a href="https://github.com/CEED/forum"><i class="fa fa-comment-o"></i> User forum</a> </li>
       <li><a href="mailto:ceed-users@llnl.gov"><i class="fa fa-envelope-o"></i> ceed-users@llnl.gov</a> </li>
   </ul>
</div>

<!-- Possible contact icons: fa-bolt, fa-cogs, fa-user, fa-star-o -->
<!-- ... fa-comment, fa-comment-o, fa-comments, fa-comments-o, fa-bullhorn --></div>
        </div>
    

        <footer class="footer hidden-xs">
           <div class="container">
              <p class="text-muted alignleft">
	      <!-- <a href="https://www.llnl.gov/disclaimer.html">Privacy & Legal Notice</a>. -->
              Developed by the <a href="../about/">CEED team</a>
              as part of the <a href="http://exascaleproject.org">Exascale Computing Project</a>
              </p>
              <div style="text-align:right">
                  <a href="http://exascaleproject.org">
                  <img src="../img/ecp-black.png"
                  style="display:inline;height:50px;padding:12px;margin:0;opacity:0.5"
                  alt="ECP logo"></a>
                  <a href="https://science.energy.gov/">
                  <img src="../img/doe-sc.png"
                  style="display:inline;height:50px;padding:12px;margin:0;opacity:0.5"
                  alt="DOE-SC logo"></a>
                  <a href="https://nnsa.energy.gov/">
                  <img src="../img/nnsa.png"
                  style="display:inline;height:50px;padding:12px;margin:0;opacity:0.5"
                  alt="NNSA logo"></a>
               </div>
               <!-- footer height is 50px -->
           </div>
        </footer>

        <footer class="footer hidden-md hidden-sm hidden-lg">
           <div class="container">
              <p class="text-muted alignleft">
		<!-- <a href="https://www.llnl.gov/disclaimer.html">Privacy & Legal Notice</a>. -->
		Developed by the <a href="../about/">CEED team</a>
              </p>
              <div style="text-align:right">
                  <a href="http://exascaleproject.org">
                  <img src="../img/ecp-black.png"
                  style="display:inline;height:50px;padding:12px;margin:0;opacity:0.5"
                  alt="ECP logo"></a>
              </div>
           </div>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
        <script src="../js/retina.min.js"></script>
        <script src="../search/main.js"></script>
    </body>
</html>